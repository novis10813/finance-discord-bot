# 籌碼分析功能使用說明

本文件說明 Discord Bot 的籌碼分析相關指令。

## 📊 功能概覽

籌碼分析功能提供以下服務：
- **每日自動推送**：每個交易日 16:00 自動推送三大法人買賣超摘要
- **市場概覽查詢**：查詢特定日期的整體市場籌碼狀況
- **個股詳細查詢**：查詢個別股票的籌碼詳情
- **歷史對比**：對比兩個日期的籌碼變化
- **趨勢分析**：查看個股近期籌碼趨勢

---

## 🤖 指令列表

### 1. 每日市場概覽

**指令**：`!chip [日期]` 或 `!daily_chip [日期]`

**說明**：查詢特定日期的三大法人買賣超摘要，包含 Top 10 買超/賣超個股。

**參數**：
- `日期`（選填）：格式 `YYYYMMDD`，例如 `20251224`。不提供則查詢今日。

**範例**：
```
!chip                # 查詢今日
!chip 20251224       # 查詢 2024/12/24
```

**回傳內容**：
- 三大法人（外資、投信、自營商）各自的買進/賣出/買賣差額
- 🏆 三大法人買超前十名（股）
- 📉 三大法人賣超前十名（股）

---

### 2. 個股籌碼詳情

**指令**：`!chip_stock <股票代碼> [日期]` 或 `!chip_detail <股票代碼> [日期]` 或 `!股票籌碼 <股票代碼> [日期]`

**說明**：查詢特定股票的詳細籌碼資料。

**參數**：
- `股票代碼`（必填）：例如 `2330`（台積電）
- `日期`（選填）：格式 `YYYYMMDD`。不提供則查詢今日。

**範例**：
```
!chip_stock 2330              # 查詢台積電今日籌碼
!chip_stock 2330 20251224     # 查詢台積電 2024/12/24 籌碼
!股票籌碼 2454                # 查詢聯發科今日籌碼
```

**回傳內容**：
- 🟢/🔴 外資買進/賣出/買賣超
- 🟢/🔴 投信買進/賣出/買賣超
- 🟢/🔴 自營商買賣超
- 三大法人合計買賣超

---

### 3. 歷史籌碼對比

**指令**：`!chip_compare <日期1> <日期2>` 或 `!籌碼對比 <日期1> <日期2>`

**說明**：對比兩個日期的三大法人買賣超變化。

**參數**：
- `日期1`（必填）：第一個日期，格式 `YYYYMMDD`
- `日期2`（必填）：第二個日期，格式 `YYYYMMDD`

**範例**：
```
!chip_compare 20251223 20251224
!籌碼對比 20251220 20251224
```

**回傳內容**：
- 📈/📉/➡️ 各法人類別的變化方向
- 兩個日期的具體買賣超金額
- 變化金額

---

### 4. 個股籌碼趨勢

**指令**：`!chip_trend <股票代碼> <法人類型> [天數]` 或 `!籌碼趨勢 <股票代碼> <法人類型> [天數]`

**說明**：查詢個股近期的籌碼趨勢變化，可指定查詢特定法人類型。

**參數**：
- `股票代碼`（必填）：例如 `2330`
- `法人類型`（選填）：可選擇以下類型，預設為「全部」
  - `外資` / `外` / `foreign`：外資買賣超
  - `投信` / `信` / `trust`：投信買賣超
  - `自營商` / `自營` / `自` / `dealer`：自營商買賣超
  - `全部` / `合計` / `all`：三大法人合計（預設）
- `天數`（選填）：查詢天數，預設 5 天，最多 10 天

**範例**：
```
!chip_trend 2330             # 查詢台積電近 5 天【三大法人合計】趨勢
!chip_trend 2330 外資         # 查詢台積電近 5 天【外資】趨勢
!chip_trend 2330 投信 10      # 查詢台積電近 10 天【投信】趨勢
!chip_trend 2454 自營商 7     # 查詢聯發科近 7 天【自營商】趨勢
!籌碼趨勢 2317 全部 10        # 查詢鴻海近 10 天【三大法人合計】趨勢
```

**回傳內容**：
- 📈/📉/➡️ 每日趨勢變化方向
- 🟢/🔴 每日買超/賣超狀態
- 每日指定法人買賣超股數
- 📊 統計：合計與平均

---

## 🔧 頻道限制設定

管理員可以限制籌碼分析指令只能在特定頻道中使用，避免在其他頻道造成干擾。

### 設定方式

在 `.env` 檔案中設定 `CHIP_ALLOWED_CHANNELS`：

```env
# 允許單一頻道
CHIP_ALLOWED_CHANNELS=1234567890123456789

# 允許多個頻道（逗號分隔）
CHIP_ALLOWED_CHANNELS=1234567890123456789,9876543210987654321,1111222233334444555

# 不設定 = 允許所有頻道（預設）
CHIP_ALLOWED_CHANNELS=
```

### 如何取得頻道 ID

1. 在 Discord 中開啟「使用者設定」
2. 進入「進階」設定
3. 開啟「開發者模式」
4. 右鍵點擊要設定的頻道
5. 選擇「複製頻道 ID」

### 行為說明

- **允許的頻道**：指令正常執行
- **禁止的頻道**：顯示「❌ 此指令只能在特定頻道使用」
- **DM（私訊）**：不允許使用
- **自動推送**：定時推送不受此限制影響

---

## 🔔 自動推送

Bot 會在每個交易日（週一至週五）**16:00** 自動推送當日的籌碼摘要到指定的 Discord 論壇頻道。

**推送內容**：
- 三大法人買賣超摘要
- Top 10 買超/賣超個股

**設定**：
- 頻道 ID 在 `.env` 中設定（`CHIP_CHANNEL_ID`）
- 預設使用「籌碼異動」標籤

---

## 💡 使用技巧

### 快速查詢常用股票
將常用股票代碼記下來，可以快速查詢：
```
!chip_stock 2330    # 台積電
!chip_stock 2454    # 聯發科
!chip_stock 2317    # 鴻海
```

### 觀察特定法人動向
使用趨勢功能觀察特定法人的動態：
```
!chip_trend 2330 外資 10    # 觀察外資近 10 天動向
!chip_trend 2330 投信 10    # 觀察投信近 10 天動向
```
如果看到某個法人連續買超後突然轉為賣超，可能是籌碼面的警訊。

### 對比重要日期
對比財報公布前後、重大事件前後的籌碼變化：
```
!chip_compare 20251220 20251224
```

---

## ⚠️ 注意事項

1. **資料來源**：所有資料來自證交所公開資訊
2. **更新時間**：證交所通常在收盤後 1-2 小時更新資料
3. **假日處理**：查詢假日會自動回傳最近一個交易日的資料
4. **資料快取**：歷史資料會被快取以提升查詢速度
5. **單位說明**：
   - 市場概覽：單位為「元」
   - 個股籌碼：單位為「股」

---

## 🛠️ 技術特色

- **錯誤處理**：自動重試機制，提升穩定性
- **資料快取**：減少 API 呼叫，提升回應速度
- **智慧日期處理**：自動處理假日和非交易日
- **趨勢去重**：自動過濾重複的假日資料

---

## 📞 問題回報

如遇到問題或有功能建議，請在 Discord 的「❓-問題求助」或「💡-功能建議」頻道回報。
